<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 1.01 Transitional//EN">
<%@ taglib prefix="s" uri="/struts-tags"%>
<%@ page contentType="text/html; charset=utf-8"%>
<%@ include file="/pages/commons/meta.jsp"%>
<%@ include file="/pages/commons/taglibs.jsp"%>
<%@page import="com.soc.model.user.User"%>
<%@ page language="java" import="java.util.*" pageEncoding="UTF-8"%>

<%
	String path = request.getContextPath();
	String basePath = request.getScheme()+"://"+request.getServerName()+":"+request.getServerPort()+path+"/";
%>
<html>

<head>
<%-- <script type="text/javascript" src="${ctx}/pushlet/ajax-pushlet-client.js"></script>--%>

<link href="${ctx}/styles/library.css" rel="stylesheet"
	type="text/css">
 <link href="${ctx}/styles/jquery-ui.custom.css" rel="stylesheet"
	type="text/css"> 
	<%-- <link href="${ctx}/styles/jquery-ui-1.8.21.css" rel="stylesheet" type="text/css"> --%>
<link href="${ctx}/styles/jquery.popuplayer.css" rel="stylesheet"
	type="text/css">
<link href="${ctx}/stylesalidationEngine.jquery.css" rel="stylesheet"
	type="text/css">
<link href="${ctx}/styles/fontColor.css" rel="stylesheet"
    type="text/css">
<script type='text/javascript' src="${ctx}/scripts/jquery-1.7.2.min.js"></script>
<script type="text/javascript" src="${ctx }/scripts/jquery-latest.js"></script>
<script type="text/javascript" src="${ctx }/scripts/jquery.tablesorter.js"></script>
<script type='text/javascript'
	src="${ctx}/scripts/jquery.validationEngine-en.js"></script>
<script type='text/javascript'
	src="${ctx}/scripts/jquery.validationEngine.js"></script>
<script type='text/javascript'
	src="${ctx}/scripts/jquery-ui.custom.min.js"></script>
<script type='text/javascript' src="${ctx}/scripts/util.js"></script>
<script type='text/javascript' src="${ctx}/scripts/popuplayer.js"></script>
<style type="text/css">
.btn1{ background:url(../images/btn_back_x1.png) no-repeat; width:39px; height:30px; border:none; cursor:pointer;}
</style>
<script language="javascript">
	function addEventLibrary(type) {
		location.href = "${ctx}/vulnerability/queryEventLibraryList.action?detail=add&eventLibraryType="+type;
	}
	var rege =/^([^`~!@#$%^&*()=|{}':;, \\\[\].<>\/?~！@#￥……&*（）—|{}【】‘；：”“'。\"，、？])*$/;
	function query() {
		/* var time = $("#time").val();//最近修改用户
		var empStatus = $("#empStatus").val();//锁定
		var groupId = $("#groupId").val();//组管理
		var keyword = $("#keyword").val();//模糊
		var order = $("#order").val();//最近更新
		location.href = "${ctx}/vulnerability/query.action?keyword="
				+ encodeURIComponent(encodeURIComponent(keyword)) + "&time="
				+ time + "&empStatus=" + empStatus + "&groupId=" + groupId
				+ "&order=" + order; */

		$('#quickQuery').val($.trim($('#quickQuery').val()));
		if(parseInt($('#quickQuery').val().length)>50){
			alert("长度不能大于50");
			$('#quickQuery').val('');
			$('#quickQuery').focus();
			return;
		}
	
	
	if(!rege.test($('#quickQuery').val())){
		alert("输入的内容包含特殊字符，请重新输入");
		$('#quickQuery').val('');
		$('#quickQuery').focus();
		return;
	}
		location.href = "${ctx}/vulnerability/queryEventLibraryList.action?eventLibraryType=${eventLibraryType}&keyword="
				+ encodeURI(encodeURI($('#quickQuery').val(), "utf-8"));
	}
	$(document).ready(function() {
		$("#keyword").keydown(function(event) {
			if (event.keyCode == 13) {
				query();
			}
		});

		// Dialog			
		$('#dialog-extQuery').dialog({
			autoOpen : false,
			width : 450,
			height : 320,
			buttons : {
				"查询[Enter]" : function() {
					extQuery();
					$(this).dialog("close");
				},

				"取消[Esc]" : function() {
					$(this).dialog("close");
				}
			}
		});

		// Dialog			
		$('#dialog-loadBalancing').dialog({
			autoOpen : false,
			width : 380,
			height : 200,
			buttons : {
				"确定[Enter]" : function() {
					import1();
				},

				"取消[Esc]" : function() {
					$(this).dialog("close");
				}
			}
		});
		
		//sort后，修改form表单提交的action地址
		var str = $('#actionStr').val();
		if (str != "query.action") {
			var url = "sort.action?" + str;
			$('#empForm').attr('action', url);
		}
		$('#listSort').tablesorter();
	});

	$("#chkAll").live("click", function(event) {
		if ($("#chkAll").hasClass('not_checked')) {
			$("#chkAll").removeClass('not_checked');
			$(".check-box").attr('checked', true);
		} else {
			$("#chkAll").addClass('not_checked');
			$(".check-box").attr('checked', false);
		}
	});

	$(document).click(function(event) {
		//shiftForCheckBoxFun(event);
		destroyOverDlg();
	});

	function overDlg(e, header, content, num) {
		$('#blk_header').html(header);
		$('#blk_content').html(content);

		createOverDiv(e, 10, 10, $('#blk').html());
	}

	function extQueryDlg() {
		$('#dialog-extQuery').dialog('open');
	}

	function extQuery() {
		var eventId = $.trim($("#evenId").val()) ; 
		if(eventId != ""){
			var reg = /^\d+$/ ;
			if(!reg.test(eventId)){
				alert("事件编号必须为数字...") ; 
				return; 
		}else{
		    $('#eventLibraryId').val(eventId);
		}
		}
		
			if(eventId.length>6){
				alert("编号长度不能大于6");
				$('#keyword').val('');
				$('#keyword').focus();
				return ;
			}
			if(!rege.test($('#evenName').val())){
				alert("输入的内容包含特殊字符，请重新输入");
				$('#evenName').val('');
				$('#evenName').focus();
				return;
			}
				if($('#evenName').val().length>50){
					alert("中文名称长度不能大于50");
					$('#evenName').val('');
					$('#evenName').focus();
					return ;
				}
				if($('#deviType').val().length>50){
					alert("设备类型长度不能大于50");
					$('#deviType').val('');
					$('#deviType').focus();
					return ;
				}
				
		$('#eventLibraryName').val($("#evenName").val()) ; 
		$('#deviceType').val($("#deviType").val());
		$('#discription').val($('#disc').val());
		
		 $('#queryEventLibrary').submit() ; 

		//$('#eventLibraryId').val($.trim($('#evenId').val()));
		//$('#eventLibraryName').val($.trim($('#evenName').val()));
		//$('#deviceType').val($.trim($('#deviType').val()));
		//$('#discription').val($.trim($('#disc').val()));
		//$("#queryEventLibrary").attr("action","${ctx}/events/queryEventLibraryList.action");
		//$('#queryEventLibrary').submit();
		
		//$('#eventName').val($.trim($('#eventName').val()));
		//location.href = "${ctx}/vulnerability/queryEventLibraryList.action?eventLibraryType=${eventLibraryType}&"+
				//"keyword="+ encodeURI(encodeURI($('#eventLibraryName').val(), "utf-8"))+
				//"&eventLibraryId="+ encodeURI(encodeURI($('#eventLibraryId').val(), "utf-8"))+
				//"&deviceType="+ encodeURI(encodeURI($('#deviceType').val(), "utf-8"))+
				//"&discription="+ encodeURI(encodeURI($('#discription').val(), "utf-8"));
	   
	    
	    
	}

	function loadBalancingDlg() {
		$('#dialog-loadBalancing').dialog('open');
	}

	function deleteEventLibrary(){
		var ids = "";
		$("[name=ids]:checkbox:checked").each(function() {
			if (ids != "") {
				ids += "," + $(this).val();
			} else {
				ids = $(this).val();
			}
		});
		if ($(":checkbox[checked = true]").size() < 1) {
			alert("请至少选择一个事件库信息...");
			return;
		}
		if (confirm("确认执行操作吗？")) {
			location.href = "location.href='${ctx}/vulnerability/deleteEventLibraryList.action?ids="
					+ ids;
		}
	}
</script>
</head>

<body style="margin-top:2px;">
	<%--<s:form action="queryEventLibraryList.action" namespace="/vulnerability" method="post"
		theme="simple" id="empForm" name="empForm"
		enctype="multipart/form-data">
		--%><table width="99%" border="0" cellspacing="0" cellpadding="0"
			class="left" style="margin-left: 4px; margin-top: 0px">
			<!-- 工具栏 -->
			<tr>
				<td>
					<div class="box">
						<div class="right">
							<input type="button" value="添加"
								style="margin-right:5px;margin-top:-2px" class="btnstyle"
								onclick="addEventLibrary(${eventLibraryType})" /> <input type="button" value="删除"
								style="margin-right:12px;margin-top:-2px" class="btnstyle"
								onclick="deleteEventLibrary();" />
						</div>

						<span class="kuaiju">快速搜索</span> 
						<input type="text" id="quickQuery" onkeypress="if(event.keyCode==13)query();" style="height: 12px;"	  name="quickQuery" class="jianju" value="${keyword}"/> 
						<img src="${ctx}/images/search.jpg" onclick="query();" style="margin-left:5px"> 
							<a href="#" class="jianju"	onclick="extQueryDlg();">高级</a>
							
					</div>
				</td>
			</tr>
			
			<tr>
				<td>
					<div class="sbox">
						<div class="cont">
							<!-- information area -->
							<s:form action="queryEventLibraryList.action" namespace="/vulnerability"
								method="post" theme="simple">
								<div id="dataList">
									<table width="100%" border="0" cellspacing="1" cellpadding="0"
										class="tab2" id="listSort">
										<thead>
										<tr height="28" class="biaoti">
											<td width="6%" class="biaoti">
												<%-- 事件类型 --%>
												<input name="eventLibraryType" type="hidden" value="${eventLibraryType }" />
												<input type="checkbox"
												id="chkAll" name="chkAll" class="check-box not_checked" />
											</td>
											<th width="40%" class="biaoti"><a class="fontColor" href="">中文名称</a></th>
											<th width="40%" class="biaoti"><a class="fontColor" href="">可能的设备源类型</a></th>
											<th width="14%" class="biaoti"><a class="fontColor" href="">详细信息</a></th>
										</tr>
										</thead>
										<tbody>
										<c:set value="1" var="root" />
										<c:set value="" var="resStr" />
										<s:property value="#session.XXX" />
										<%-- 遍历事件列表 --%>
										<s:iterator value="eventLibrarys" status="eventLibrary">
											
											<tr>
												<td class="biaocm" valign="middle">
													<input type="checkbox" name="ids" id="ids"
														value="${eventLibraryId}" class="check-box" />
												</td>
												<td valign="middle">${eventLibraryName}</td>
												<td valign="middle">${deviceType}</td>
												<td valign="middle"><a href="/soc/vulnerability/queryEventLibraryList.action?eventLibraryType=${eventLibraryType }&eventLibraryId=${eventLibraryId }&detail=info">详细信息</a></td>
											</tr>
											<c:set value="${root+1}" var="root" />
										</s:iterator>
										</tbody>
										<%--首页、上一页、下一页、末页 --%>
										<tr>
											<td colspan="6" width="100%"><jsp:include page="../commons/page.jsp"></jsp:include></td>
										</tr>
									</table>
								</div>
								<!-- information area -->
							</s:form>
						</div>
					</div>
				</td>
			</tr>
		</table>
		<!-- ext query from -->
	<s:form action="queryEventLibraryList.action" namespace="/vulnerability" method="post"
		theme="simple" id="queryEventLibrary" name="queryEventLibrary">
		<s:hidden name="eventLibraryId" id="eventLibraryId" />
		<s:hidden name="eventLibraryName" id="eventLibraryName" />
		<s:hidden name="deviceType" id="deviceType" />
		<s:hidden name="discription" id="discription" />
	    <input type="hidden" name="eventLibraryType" id="eventLibraryType"  value="${eventLibraryType  }" />
 	</s:form>
	
	
	<div id="dialog-extQuery" title="高级查询">
		<table width="90%" border="0" cellspacing="5" cellpadding="5"
			class="gaojiquery">
			<tr>
				<td width="25%">事件编号:</td>
				<td><input id="evenId"
					name="evenId" type="text"
					class="gaojitd" onkeypress="if(event.keyCode==13)extQuery();" />
				</td>
			</tr>
			<tr>
				<td>中文名称:</td>
				<td><input id="evenName" name="evenName"
					type="text" class="gaojitd"
					onkeypress="if(event.keyCode==13)extQuery();" />
				</td>
			</tr>
			<tr>
				<td>设备类型:</td>
				<td><input id="deviType" name="deviType"
					type="text" class="gaojitd"
					onkeypress="if(event.keyCode==13)extQuery();" />
				</td>
			</tr>
			<tr>
				<td>摘要:</td>
				<td><input id="disc"
					name="disc" type="text" class="gaojitd" 
					onkeypress="if(event.keyCode==13)extQuery();" />
				</td>
			</tr>
		</table>
	</div>

	
	<!-- over layer -->
	<div id="blk" style="display:none;">
		<div class="blk">
			<div class="head">
				<div class="head-right"></div>
			</div>
			<div class="main">
				<h2 id="blk_header">#header#</h2>
				<div id="blk_content">#content#</div>
			</div>
			<div class="foot">
				<div class="foot-right"></div>
			</div>
		</div>
	</div>
<input type="hidden" id="actionStr" value="${actionStr}"/>

	<!-- ui-dialog -->

	<%--  <s:iterator value="#request.listVulnerability">
	${vulnerabilityType}
	</s:iterator> --%>
</body>
</html>
